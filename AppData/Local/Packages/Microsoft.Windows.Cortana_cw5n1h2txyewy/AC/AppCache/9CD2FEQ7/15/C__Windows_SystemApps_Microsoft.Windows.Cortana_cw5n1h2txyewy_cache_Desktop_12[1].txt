var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},AutoSuggest;(function(n){var t;(function(t){function e(n,t){var i=n.query?n.query:HitHighlightingParser.removeMarkers(n.text),r=i?i.length:0;return n.additionalInfoText&&!t&&(r+=n.additionalInfoText.length),r>(t?at:vt)}function nt(n){var t={topResults:n.topResults.slice(0),groups:[]};return n.groups.forEach(function(n){t.groups.push({type:n.type,suggestions:n.suggestions.slice(0)})}),t}function tt(n){if(n.isAnswer)return ot;var t=n.hasAdditionalInfoText?et:ft;return n.wrapsToTwoLines&&(t+=p),t}function pt(n){if(n.isSuppressed)return 0;var t=rt;return n.wrapsToTwoLines&&(t+=p),t}function u(n){return n.scope==0&&!n.taskFrame}function wt(n,i,r){var f=y,e,o;return i.type&&t.useGridLayout(r,n,i.type)?(e=Math.ceil(i.suggestions.length/(u(n)?d:k)),o=u(n)?b:w,f+=o*e,f+=2*c):i.type&&(i.type===19||i.type===9)?i.suggestions.forEach(function(n){return f+=tt({wrapsToTwoLines:!1,hasAdditionalInfoText:!0,isAnswer:!1,isSuppressed:n.isSuppressed})}):i.suggestions.forEach(function(n){return f+=pt(n)}),f}function bt(n){switch(n){case 0:return t.SearchServiceStatus.ContinuePending;case 7:return t.SearchServiceStatus.Disabled;case 1:return t.SearchServiceStatus.PausePending;case 2:return t.SearchServiceStatus.Paused;case 4:return t.SearchServiceStatus.StartPending;case 5:return t.SearchServiceStatus.StopPending;case 6:return t.SearchServiceStatus.Stopped}return undefined}function l(n,t){return n.length>0&&t.length>0?n.concat(yt).concat(t):n.length>0?n:t.length>0?t:[]}var a=6,o=8,f=12,v=3,i=1,r=20,s=16,rt=r+2*o,y=s+2*o,ut=y,ft=r+s+v+2*f,et=r+2*(s+v)+2*f,ot=80+2*f,h=r+2*f+i,st=40,ht=o+i,p=r,ct=48,lt=i,c=1,w=t.IconSize_GridLayout+2*(a+i),b=t.IconSize_GridLayout_Medium+2*(a+i),k=3,d=4,at=39,vt=42,yt={verb:null,displayName:null,executeAsync:null},g="Classic_{87d66a43-7b11-4a28-9811-c86ee395acf7}",kt=function(){function n(){}return n.PersistentDisambig="WNSMYS",n}(),it;t.joinVerbsWithSeparator=l;it=function(i){function r(r,u,f,e,o,s,h,l){var a=this,v,y;i.call(this,r,u,e,o,h);this._host=u;this._autoComplete=f;this._navigationHelper=s;this._scopesViewModel=l;this.permanentDisambig=[];this._pendingSubmitSequenceNumber=-1;this._pendingSubmitModifierKeys=null;this._resultsCounter={topResults:[],groups:[]};this._suggestionsContainerHeight=0;this._initialized=!1;this._animateProactiveCards=!0;this._container=_ge("qfContainer");h.setContextMenuHandler(function(n,t){return a.showContextMenu(n,t.pageX,t.pageY)});h.setSuggestionClickHandler(function(n){return a.click(n)});h.setRemoveSuggestionClickHandler(function(n){return a.remove(n)});u.bindKeyDown(function(n,t){return a.onKeyDown(n,t)});u.bindKeyUp(function(n){return a.onKeyUp(n)});v=SearchAppWrapper.CortanaApp.searchBox.isMock;u.bindAppVisible(function(){ThresholdUtilities.getCortanaHeaders(function(n){var u,r,f,i;n&&(u=n["X-BM-DeviceDimensionsLogical"],u&&(r=u.split("x"),r.length==2&&((t.isMobileCache||v)&&(f=_ge("root"),f.style.height=r[1]+"px"),i=parseInt(r[0]),i&&(d=Math.floor((i-2*c)/b),k=Math.floor((i-2*c)/w),v&&(f.style.width=i+"px")))))});a.resetSuggestionsContainerHeight()});u.bindShown(function(){!t.isMobileCache&&SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync&&t.Promise.safeChain("getSearchServiceStatusAsync",function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync()},function(n){a._instrumentationHelper.setSearchServiceStatus(bt(n));n!=0&&n!=4&&n!=3&&n!=7&&a.showIndexingMessage(!1)})});u.bindDismissed(function(){a.removeProgressBar();t.ContextMenus.dismiss();a._page.hideTemporaryMessage();a.hideIndexingMessage();a._initialized=!1;a._animateProactiveCards=!0;a.permanentDisambig=[];a._config.showMyStuffLinks&&a.renderPermanentDisambig();a._scopesViewModel.render(null,!1,!0,!1,!0)});h.bindOnNarratorLaunch(function(n){for(var i=a.getSelectableItems(),t=0;t<i.length;t++)if(i[t].id==n){a.select(i[t],!1);a.submit(i[t].sequenceNumber,function(){},null,!0);break}});r.searchBoxFocusEvents?(u.bindSearchBoxGotFocus(function(){var t=n.getCurrentActiveElement();t&&t.blur();a.toggleSelectedSuggestionState(!0)}),u.bindSearchBoxLostFocus(function(){sb_st(function(){SearchAppWrapper.CortanaApp.searchBox.hasFocus||a.toggleSelectedSuggestionState(!1)},50)})):(y=SearchAppWrapper.CortanaApp.searchBox,y.addEventListener("keydown",function(n){n.keyCode==9&&a._selectedItem&&a.toggleSelectedSuggestionState(!1)}))}return __extends(r,i),r.prototype.toggleSelectedSuggestionState=function(n){this._selectedItem&&(this._selectedItem.selected=n,this.renderSelection(this._selectedItem))},r.prototype.update=function(n,t,r,u,f,e,o,s,h){var c=i.prototype.update.call(this,n,t,r,u,f,e,o,s,h);return(c===0||h)&&this.removeProgressBar(),c},r.prototype.removeProgressBar=function(){n.isEmpty(this._config.scopesWithProgressBar)||(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),this._page.setProgressIndicatorVisibility(!1))},r.prototype.ensureInitialized=function(){var i=this,r=this._sequenceNumberReader.getSequenceNumber();if(this._initialized){this._instrumentationHelper.instrumentSyntheticSuggestions(r,this.permanentDisambig);return}this.permanentDisambig=[];this._config.showMyStuffLinks&&(this.permanentSearchMyStuff=t.createSuggestion(this._host.getLocString(n.isBingEnabledCache?"DisambigMyStuff":"SearchMyStuff"),null,{content:t.CortanaFontIcons.WindowsLogo,type:2,needsAccentColor:!0},t.SyntheticQSCodes.PersistentSearchMyStuff,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(t.SyntheticQSCodes.PersistentSearchMyStuff,t.SyntheticQSCodes.KValues),4,n.InstrumentationCommon.INVALID_SEQUENCE_NUMBER,"psms",function(){return i.launchMyStuff(i._partialQuery,null,kt.PersistentDisambig)}),this.permanentSearchMyStuff.narratorText=this._partialQuery?n.formatString(this._host.getLocString("SearchMyStuffFor"),[this._partialQuery.queryToFetch]):this._host.getLocString("SearchMyStuff"),this.permanentDisambig.push(this.permanentSearchMyStuff),n.isBingEnabledCache&&(this.permanentSearchTheWeb=t.createSuggestion(this._host.getLocString("DisambigWeb"),null,{content:t.CortanaFontIcons.Search,type:2},t.SyntheticQSCodes.PersistentSearchTheWeb,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(t.SyntheticQSCodes.PersistentSearchTheWeb,t.SyntheticQSCodes.KValues),0,n.InstrumentationCommon.INVALID_SEQUENCE_NUMBER,"pstw",function(){return i.launchSearch(i._partialQuery,t.SyntheticQSCodes.PersistentSearchTheWeb)}),this.permanentSearchTheWeb.narratorText=this._partialQuery?n.formatString(this._host.getLocString("SearchTheWebFor"),[this._partialQuery.queryToFetch]):this._host.getLocString("SearchTheWeb"),this.permanentDisambig.push(this.permanentSearchTheWeb)),this.renderPermanentDisambig(),this._instrumentationHelper.instrumentSyntheticSuggestions(r,this.permanentDisambig));this._initialized=!0},r.prototype.resetPendingSubmitSequenceNumber=function(){this._pendingSubmitSequenceNumber=null;this._stopFurtherProcessing=null;this._pendingSubmitModifierKeys=null},r.prototype.onKeyDown=function(i,r){var u,o,f;if(i!=13&&(this._page.hideTemporaryMessage(),this.resetPendingSubmitSequenceNumber()),!n.isNavigationKey(i)){if(n.isContextMenuKey(i,r.shiftKey)&&this._selectedItem&&!this.isGroup(this._selectedItem)&&!n.contains(this.permanentDisambig,this._selectedItem)){u=this._selectedItem;o=_ge(u.id);this.showContextMenu(u,120,o.offsetTop+this._container.scrollTop+24);return}if(i==13&&t.ContextMenus.getSelectedItem()||t.ContextMenus.dismiss(),i==39&&this._selectedItem&&this.isGroup(this._selectedItem)&&(f=this._host.getQuery(),f.originalQuery.length==f.originalCursorPosition&&this._selectedItem.click()),!this._config.showMyStuffLinks&&(i==33||i==34)){var e=this.getSelectableItems(),s=e.indexOf(this.getSelectedItem()),h=this.getGroupHeaderIndices(e),c=this.getNextGroupHeaderIndex(h,s,i);this.select(e[c+1],!0)}}},r.prototype.getGroupHeaderIndices=function(n){for(var i=[-1],t=0;t<n.length;t++)this.isGroup(n[t])&&i.push(t);return i},r.prototype.getNextGroupHeaderIndex=function(n,t,i){for(var r=n.length-1;r>0&&t<n[r];)r--;return r+=i==34?1:-1,r+=n.length,r%=n.length,n[r]},r.prototype.onKeyUp=function(i){var f,r,u;if(i==9&&this._selectedItem&&!this._config.searchBoxFocusEvents){f=n.getCurrentActiveElement();this.toggleSelectedSuggestionState(t.isBodyOrSuggestion(f));return}n.isNavigationKey(i)&&this._selectedItem&&(r=_ge(this._selectedItem.id),this.scrollToSuggestion(r,this._container,this._container.offsetHeight),u=window.innerHeight,t.isMobileCache&&_d.body.scrollHeight>u&&this.scrollToSuggestion(r,_d.body,u))},r.prototype.scrollToSuggestion=function(n,t,i){var u=t.scrollTop,r=n.offsetTop,f=r+n.offsetHeight;f>u+i?t.scrollTop=f-i:r<u&&(t.scrollTop=r)},r.prototype.scrollToTop=function(){this._container.scrollTop=0;_d.body.scrollTop=0},r.prototype.onQueryChanged=function(r,u){var e=this,h=this._config.scopesWithProgressBar,o,f,s;(n.isEmpty(h)||(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),!h[t.Scope[r.scope]]||n.isEmpty(r.enabledDataSources)?this._page.setProgressIndicatorVisibility(!1):this._progressTimer=sb_st(function(){return n.safeExecute(function(){e._progressTimer&&(e._page.setProgressIndicatorVisibility(!0),e._progressTimer=null)},"showProgress")},250)),i.prototype.onQueryChanged.call(this,r,u),this.ensureInitialized(),this.permanentDisambig.forEach(function(n){return n.sequenceNumber=u}),t.ContextMenus.dismiss(),this._partialQuery&&this._partialQuery.equals(r))||(this._partialQuery&&this._partialQuery.scope!=r.scope&&this.hideIndexingMessage(),o=this._partialQuery?this._partialQuery.queryToFetch:"",f=r.queryToFetch,this._partialQuery=r,s=!1,this._config.hhUpdateType!=3&&this.topResults.forEach(function(n){if(n.updateFromQuery)e._config.hhUpdateType!=2&&(s=n.updateFromQuery(r));else if(e._config.hhUpdateType!=1&&f.length>o.length&&f.startsWith(o)&&n.query&&n.query.toLowerCase().includes(r.queryToFetch.toLowerCase())){var t=n.text.indexOf(HitHighlightingParser.endMarker);t>=0&&t<n.text.length-1&&(n.text=n.text.substr(0,t)+n.text.substr(t+1,f.length-o.length)+HitHighlightingParser.endMarker+n.text.substr(t+1+f.length-o.length),s=!0)}}),s&&(this.renderTopResults(),this._instrumentationHelper.instrumentTopResultRendered(this._sequenceNumberReader.getSequenceNumber(),this.topResults.map(function(n){return n.type}))),this._config.showMyStuffLinks&&(this.permanentSearchTheWeb&&(this.permanentSearchTheWeb.narratorText=f+", "+this._host.getLocString("SearchTheWeb")),this.permanentSearchMyStuff&&(this.permanentSearchMyStuff.narratorText=f+", "+this._host.getLocString("SearchMyStuff")),this.renderPermanentDisambig()))},r.prototype.onSuggestionsParsed=function(n,i,r,u){(u===t.LocalProviderIndexerState.NotIndexed||u===t.LocalProviderIndexerState.PartiallyIndexed)&&(r==t.DataSources.LocalApps||r==t.DataSources.LocalSettings||n.scope!=0)&&n.scope!=9&&this.showIndexingMessage(!0)},r.prototype.getSelectableItems=function(){if(t.ContextMenus.isContextMenuVisible())return t.ContextMenus.getSelectableItems();if(!this._partialQuery.fullPartialQuery||!t.isBodyOrSuggestion(n.getCurrentActiveElement()))return[];var i=this.topResults;return this.groups.forEach(function(n){n.click&&(i=i.concat(n));i=i.concat(n.suggestions.filter(function(n){return!n.suppressed}))}),i=i.concat(this.permanentDisambig)},r.prototype.getSelectedItem=function(){return t.ContextMenus.isContextMenuVisible()?t.ContextMenus.getSelectedItem():this._selectedItem},r.prototype.renderSelection=function(t,i){(t&&n.contains(this.topResults,t)||i&&n.contains(this.topResults,i))&&this.renderTopResults();(t&&this.isGroup(t)&&n.contains(this.groups,t)||t&&this.groups.some(function(i){return n.contains(i.suggestions,t)})||i&&this.isGroup(i)&&n.contains(this.groups,i)||i&&this.groups.some(function(t){return n.contains(t.suggestions,i)}))&&this.renderGroups();(t&&n.contains(this.permanentDisambig,t)||i&&n.contains(this.permanentDisambig,i))&&this.renderPermanentDisambig()},r.prototype.select=function(n,i){var u,r;t.ContextMenus.isContextMenuVisible()?t.ContextMenus.select(n):(u=this._selectedItem,u&&(u.selected=!1),this._selectedItem=n,n&&(n.selected=!0),this.renderSelection(n,u),i&&(r=n?n.query:null,r&&this._partialQuery.scopePrefix&&(r=this._partialQuery.scopePrefix+": "+r),this._host.setQuery(r,!1,!1)))},r.prototype.populateImageRatio=function(n,i,r){if(i.icon&&i.icon.type==0&&t.useGridLayout(this._config,n,i.type)){var f=function(f){var e=u(n)?t.IconSize_GridLayout_Medium:t.IconSize_GridLayout;f.height>e&&f.width>e&&t.updateRatio(i,f);r()};t.getIconDimensions(i.icon,f)}else r()},r.prototype.getImageSize=function(n,i,r){return r?0:t.useGridLayout(this._config,n,i.type)?u(n)?3:2:1},r.prototype.allowUnselectedState=function(){return this.topResults.length==0},r.prototype.isGroup=function(n){return!!n.suggestions},r.prototype.submit=function(i,r,u,f){var e=t.ContextMenus.getSelectedItem(),o=f?2:0;if(e){e.click(o,u);r();return}var s=n.getCurrentActiveElement(),h=!t.isBodyOrSuggestion(s),c=this._host.isRequestFocusAvailable();if(h){c||(s.click(),r());return}if(this._lastUpdatedSequenceNumber!=i&&(!this._selectedItem||this._selectedItem==this.topResults[0])){this._pendingSubmitSequenceNumber=i;this._pendingSubmitModifierKeys=u;this._stopFurtherProcessing=r;return}this._selectedItem?(this._selectedItem.instItem&&this._instrumentationHelper.instrumentCustomGping(o,this._selectedItem.instItem.getHValue(),null,u),this.click(this._selectedItem,u),r()):this.groups.length>0&&this._partialQuery.fullPartialQuery&&this.showDisableEnterMessage()},r.prototype.click=function(n,i){if(n.instItem&&this._instrumentationHelper.instrumentItemClick(n.sequenceNumber,n.sequenceNumber>this._lastUpdatedSequenceNumber),this.isGroup(n)){n.click();return}var r=n;if(!r.suppressed){i=i||this._host.getModifierKeyState();i.ctrlKey&&i.shiftKey?this.launchVerb(r,t.Verbs.LaunchAsAdmin):i.shiftKey?this.launchVerb(r,t.Verbs.OpenInNewWindow):r.click();this.onSuggestionLaunch(r)}},r.prototype.remove=function(n){this._instrumentationHelper.instrumentItemClick(n.sequenceNumber);this.launchVerb(n,t.Verbs.RemoveFromDeviceHistory);n.suppressed=!0;this._host.setFocusInSearchBox("remove")},r.prototype.launchVerb=function(n,i){this.getDeviceItemVerbsAsync("launchVerb",n,function(r){var u=!1;r.forEach(function(n){n.verb==i&&(t.Promise.safeChain(i+".executeAsync",function(){return n.executeAsync()}),u=!0)});u||n.click()})||n.click()},r.prototype.showContextMenu=function(n,i,r){var u=this;this.getDeviceItemVerbsAsync("showContextMenu",n,function(f){return t.ContextMenus.showContextMenu(f,i,r,function(t,i,r){u._instrumentationHelper.instrumentItemClick(n.sequenceNumber);u._instrumentationHelper.instrumentCustomGping(i,n.instItem.getHValue(),t,r)},u._page,function(){return u._host.setFocusInSearchBox("contextMenuClick")})})},r.prototype.getDeviceItemVerbsAsync=function(n,i,r){var f=this,o=t.asJumpListSuggestion(i),u,e;return o?(t.Promise.safeChain("jumpListItem.getVerbsAsync",function(){return o.jumpListItem.getVerbsAsync()},function(n){return f.handleExtraVerbsAsync(n.slice(0),i,u,r)},function(){return f.handleExtraVerbsAsync([],i,u,r)},null,n+" "+i.type),!0):(u=n+" "+i.type,e=t.getItemWithFileMetadata(i),e&&e.canHaveContextMenu)?(t.Promise.safeChain("getVerbsAsync",function(){return e.getVerbsAsync()},function(n){return f.handleExtraVerbsAsync(n.slice(0),i,u,r)},function(){return f.handleExtraVerbsAsync([],i,u,r)},null,u),!0):i.getExtraVerbsAsync?(this.handleExtraVerbsAsync([],i,u,r),!0):i.getExtraVerbs?(this.handleExtraVerbs([],i,r),!0):!1},r.prototype.handleExtraVerbsAsync=function(n,i,r,u){var f=this;i.getExtraVerbsAsync?t.Promise.safeChain("getExtraVerbsAsync",function(){return i.getExtraVerbsAsync()},function(t){return f.handleExtraVerbs(l(n,t),i,u)},function(){return f.handleExtraVerbs(n,i,u)},null,r):this.handleExtraVerbs(n,i,u)},r.prototype.handleExtraVerbs=function(n,t,i){t.getExtraVerbs?i(l(n,t.getExtraVerbs())):i(n)},r.prototype.getGroupHeaderClickAction=function(i,r,u){var f=this,o,e,s;if(!t.isMobileCache&&(o=t.getScope(r),o!=0))return o==i.scope?[null,null]:[function(){return f._scopesViewModel.clickHandler(o,"groupHeader")},null];switch(r){case 10:e=function(){return f._host.launchStoreSearch(i.queryToFetch)};break;case 11:e=function(){return f.launchSearch(i,u)};break;case 12:e=function(){return f._host.launchFolder(f.getFolderPathForPathCompletion(i))}}if(e){if(!u)throw"No QS code for: "+n.GroupType[r];return s=n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,t.SyntheticQSCodes.KValues),[e,s]}return[null,null]},r.prototype.getFolderPathForPathCompletion=function(n){return n.queryToFetch.substring(0,this._partialQuery.queryToFetch.lastIndexOf("\\"))},r.prototype.getGroupTitleAndNarratorText=function(i,r,u,f){var e,o,s,h;if(r==12)return e=this.getFolderPathForPathCompletion(i)+"\\"+String.fromCharCode(8206),{title:e,narratorText:e};if(t.isJumpListGroup(r))return e=t.asJumpListSuggestion(u).groupDisplayName,{title:e,narratorText:e};switch(r){case 3:e=this._host.getLocString("CommandGroup");break;case 2:e=this._host.getLocString("CortanaGroup");break;case 10:e=this._host.getLocString("StoreGroup");break;case 13:e=this._host.getLocString("PowerBIGroup");break;case 21:e=this._host.getLocString("EdgeHistoryGroup")}if(o=this._host.getLocString("AddingScopeNarratorText"),e)return{title:e,narratorText:f?n.formatString(o,[e]):e};if(s=t.getScope(r),s==0)throw new Error("Unknown group type: "+r);return h=t.ScopeConfig[s],e=t.getScopeDisplayName(h,this._host),{title:e,narratorText:f?n.formatString(o,[e]):e}},r.prototype.createGroup=function(i,r,u){var e=t.GroupHeaderQSCodes[i],o=this.getGroupHeaderClickAction(this._partialQuery,i,e),s=o[0],f=o[1],h=this.getGroupTitleAndNarratorText(this._partialQuery,i,r,s),c="",l;return t.isJumpListGroup(i)&&(c+=" jumpList"),l={type:i,id:"gr"+i,title:h.title,narratorText:h.narratorText,click:s,suggestions:[],instRegionName:n.GroupType[i],instItem:f,selected:!1,cssClasses:c,sequenceNumber:u},f&&this._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,e,f),this._resultsCounter.groups.push({type:i,suggestions:[]}),l},r.prototype.onAfterRenderTopResults=function(i,r){var f=this,u;if(this._resultsCounter.topResults=[],this.topResults.forEach(function(n){f._resultsCounter.topResults.push({wrapsToTwoLines:e(n,!0,f._host),hasAdditionalInfoText:!!n.additionalInfoTextForTopResult||!!n.stars,isAnswer:!!n.answerHtml,isSuppressed:!1})}),this._autoComplete&&this.topResults.length>0&&this._selectedItem==this.topResults[0]&&this._autoComplete.apply(this.topResults[0]),this._pendingSubmitSequenceNumber==this._lastUpdatedSequenceNumber)try{if(this.topResults.length==0)(this.groups.length>0||r.length>0)&&this.showDisableEnterMessage();else return this._instrumentationHelper.instrumentCustomGping(0,this.topResults[0].instItem.getHValue(),null,this._pendingSubmitModifierKeys),this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.ctrlKey&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(this.topResults[0],t.Verbs.LaunchAsAdmin):this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(this.topResults[0],t.Verbs.OpenInNewWindow):this.topResults[0].click(),this._stopFurtherProcessing(),0}finally{this.resetPendingSubmitSequenceNumber()}return n.isDataSourceEnabled(t.DataSources.Proactive,this._partialQuery,this._config)&&!this._partialQuery.fullPartialQuery&&this.topResults.length>0&&(n.Ajax.onAfterRender(),u=_ge("b_results"),this._animateProactiveCards?(this._animateProactiveCards=!1,Animation.cascadeList(u)):u.classList.remove("b_slideListHide")),1},r.prototype.showDisableEnterMessage=function(){this._page.showTemporaryMessage(this._host.getLocString("EnterOnAmbiguousTopHitMessageText"),{content:t.CortanaFontIcons.Info,type:2})},r.prototype.showIndexingMessage=function(n){var r=this,i;t.isMobileCache||(i=this._page.showIndexingMessage(n,this._config.showEnableIndexerLink&&!n?function(){return t.Promise.safeChain("showIndexingMessage_findSettingsAsync",function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findSettingsAsync([g])},function(n){var t=n[g];t&&r._host.launchDeviceItem(t,"showIndexingMessage")})}:null),i&&this.resetSuggestionsContainerHeight())},r.prototype.hideIndexingMessage=function(){t.isMobileCache||this._page.hideIndexingMessage()&&this.resetSuggestionsContainerHeight()},r.prototype.allowedInGroups=function(n){return n.handoffType==6?!n.miniAnswerOnly&&n.type!=t.OnlineSuggestionTypes.GenericTp2Answer:!0},r.prototype.resetSuggestionsContainerHeight=function(){this._suggestionsContainerHeight=0},r.prototype.calculateSuggestionsContainerHeight=function(){var t=_ge("root").clientHeight,i=_ge("indexingMessage");t-=i.offsetHeight;this._config.showMyStuffLinks?(n.safeExecute(function(){var n=_ge("permanentDisambig").firstChild.offsetHeight;h!=n&&(_ge("container").style.height=t-n+"px",h=n)},"getting permanent disambig height"),this._suggestionsContainerHeight=t-h):this._suggestionsContainerHeight=t},r.prototype.getAvailableSpace=function(n){var r=this,i,u,f;return this._suggestionsContainerHeight||this.calculateSuggestionsContainerHeight(),i=this._suggestionsContainerHeight,this._config.extraPadding&&!this._host.getFeatureEnabled(t.SearchBoxOnTopFeatureName).featureEnabled&&(i-=this._config.extraPadding),t.isOemEnabled()&&(u=t.ScopeConfig[this._partialQuery.scope],u.canUseOemDataSources&&(i-=st)),f=this._config.scopesOrder.length>0&&(this._config.scopeBarAtBottom||this._host.getFeatureEnabled(t.SearchBoxOnTopFeatureName).featureEnabled),f&&(i-=lt),this._config.scopesOrder.length>0&&(i-=ct),n.topResults.length!=0&&(i-=ut),(this._partialQuery.scope!=0||this._partialQuery.taskFrame)&&this._partialQuery.queryToFetch&&(i*=2),n.topResults.forEach(function(n){return i-=tt(n)}),n.groups.forEach(function(n){return i-=wt(r._partialQuery,n,r._config)}),n.groups.some(function(n){return n.type&&t.isJumpListGroup(n.type)})&&n.groups.some(function(n){return n.type&&!t.isJumpListGroup(n.type)})&&(i-=ht),i},r.prototype.canFitSuggestion=function(n,t,i){if(!this._partialQuery.fullPartialQuery)return!0;var u=nt(this._resultsCounter),r;return n?(r={type:t,suggestions:[]},u.groups.push(r)):r=u.groups.filter(function(n){return n.type==t})[0],r.suggestions.push({wrapsToTwoLines:i&&e(i,!1,this._host),isSuppressed:i&&i.suppressed}),this.getAvailableSpace(u)>=0},r.prototype.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup=function(){var r=this,n=nt(this._resultsCounter),t,i;for(n.groups.forEach(function(n){while(n.suggestions.length<r._config.minSuggestionsPerGroup)n.suggestions.push(n.suggestions[0])});this.getAvailableSpace(n)>0;){for(t={type:undefined,suggestions:[]},i=0;i<this._config.minSuggestionsPerGroup;++i)t.suggestions.push({wrapsToTwoLines:!1,isSuppressed:!1});n.groups.push(t)}return n.groups.length-1},r.prototype.onSuggestionAdded=function(i,r){var s=this,f=t.asJumpListSuggestion(i),h,o;f&&(f.displayed=!0,t.Promise.safeChain("getJumpListDescription",function(){return f.jumpListItem.getDescriptionAsync()},function(i){s.groups.some(function(i){return t.isJumpListGroup(i.type)&&n.contains(i.suggestions,f)})&&(f.tooltip=i,s.renderGroups())}));this.setRemoveIconForDeviceHistory(i);h=this._resultsCounter.groups.filter(function(n){return n.type==r.type})[0];h.suggestions.push({wrapsToTwoLines:e(i,!1,this._host),isSuppressed:i.suppressed});t.useGridLayout(this._config,this._partialQuery,r.type)&&r.suggestions.filter(function(n){return!n.suppressed}).length==1&&(o="gridLayout",u(this._partialQuery)&&(o+=" gridLayoutMedium"),r.cssClasses=o)},r.prototype.onSuggestionRemoved=function(i,r){var u=this._resultsCounter.groups.filter(function(n){return n.type==r.type})[0],f=e(i,!1,this._host),o=n.indexOf(u.suggestions,function(n){return n.wrapsToTwoLines==f});u.suggestions.splice(o,1);t.useGridLayout(this._config,this._partialQuery,r.type)&&r.suggestions.filter(function(n){return!n.suppressed}).length==0&&(r.cssClasses="")},r.prototype.onGroupRemoved=function(n){this._resultsCounter.groups=this._resultsCounter.groups.filter(function(t){return t.type!=n.type})},r.prototype.onGroupsCleared=function(){this._resultsCounter.groups=[]},r.prototype.getGroupType=function(n){return t.getGroupType(n)},r.prototype.launchSearch=function(n,t){var i=n.queryToFetch;this._host.launchSearch(i,this._navigationHelper.getSearchUrl(n.fullPartialQuery,i,t),!1)},r.prototype.launchMyStuff=function(n,i,r){var u=n.queryToFetch||n.fullPartialQuery,f=t.ScopeConfig[i==null?n.scope:i].myStuffPivot;this._host.launchMyStuff(u,f,r,this.groups.map(function(n){return n.type}),this.topResults)},r.prototype.setRemoveIconForDeviceHistory=function(n){n.getExtraVerbs&&n.getExtraVerbs().some(function(n){return n.verb==t.Verbs.RemoveFromDeviceHistory})&&t.setRemoveIcon(n)},r.prototype.onBeforeRenderTopResults=function(i,r,u,f){var h=this,e,o,s,c;return this.topResults.forEach(function(n){return h.setRemoveIconForDeviceHistory(n)}),e=1,this.topResults.length!=1||this.topResults[0].hasJumpListDisplayed||r.some(function(n){return!!t.asJumpListSuggestion(n)})&&(this.topResults[0].hasJumpListDisplayed=!0,e=0),o=this.getSelectableItems(),this._selectedItem&&n.contains(o,this._selectedItem)&&(this._selectedItem!=i[0]||this.topResults[0]==i[0])||(this.select(o.length>0?this.topResults[0]:null,!1),this.scrollToTop()),s=this.topResults.length>0,c=!s&&this.groups.length==0&&!r.some(function(n){return h.canFitSuggestion(!0,t.getGroupType(n),n)}),this._scopesViewModel.render(this._partialQuery,s,c,u,f),e},r.prototype.renderPermanentDisambig=function(){this._page.updatePermanentDisambigView(this.permanentDisambig)},r.prototype.renderTopResults=function(){n.isDataSourceEnabled(t.DataSources.Proactive,this._partialQuery,this._config)&&!this._partialQuery.fullPartialQuery?(this.topResults.length>0&&n.Ajax.onBeforeRender(),this._page.updateProactiveCardsView(this.topResults)):i.prototype.renderTopResults.call(this)},r.prototype.renderGroups=function(){n.isDataSourceEnabled(t.DataSources.Proactive,this._partialQuery,this._config)&&!this._partialQuery.fullPartialQuery?this._page.updateZeroInputGroupsView(this.groups):i.prototype.renderGroups.call(this)},r.prototype.onSuggestionLaunch=function(n){this._partialQuery.useOemDataSources&&t.isFileOrFolder(n.type)||i.prototype.onSuggestionLaunch.call(this,n)},r.prototype.isRankable=function(n){var t=this;return n.type!=11&&n.type!=2&&!n.suggestions.some(function(n){return t._config.enforceOriginalOrderForTypes[n.type]})},r}(n.BaseRootViewModel);t.RootViewModel=it})(t=n.Windows||(n.Windows={}))})(AutoSuggest||(AutoSuggest={}))